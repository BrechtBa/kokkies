<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">


<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-material/paper-material.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">

<dom-module id="view-login">

    <template>

        <style include="iron-flex iron-flex-alignment"></style>
        <style include="shared-styles"></style>
        <style>
            :host {
                display: block;
            }
            .page {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                z-index: 100;
                background: var(--app-primary-color);
                color: #ffffff;

                @apply(--layout);
                @apply(--layout-center-center);
            }
            paper-material{
                padding: 10px;
            }
            .buttons{
                margin-top: 10px;
                text-align: center;
            }
            .page paper-button > * {
                vertical-align: middle;
                text-transform: none;
                color: #ffffff;
            }
            .page paper-input-container{
                 --paper-input-container-color: #dddddd;
                 --paper-input-container-input-color: #ffffff;
            }
            .info {
                margin-top: 40px;
                text-align: center;
                color: #ffffff;
            }
            .info a{
                color: #1f0d9e;
            }
            .hidden{
                display: none;
            }

        </style>

        <firebase-auth id="auth" app-name="kokkies" user="{{user}}" signed-in="{{signedIn}}"></firebase-auth>

        <div class$="[[_hideLogin(signedIn)]]">

            <div class="page vertical layout">
                <h1>Kokkies</h1>

                <paper-material>
                    <paper-input label="email" value="{{email}}"></paper-input>
                    <paper-input label="password" value="{{password}}" type="password"></paper-input>

                    <div class="buttons">
                        <paper-button raised on-tap="signIn" disabled="[[disabled]]">
                            <iron-icon icon="account-circle"></iron-icon>
                            <span>Sign in</span>
                        </paper-button>
                    </div>

                    <div class="info">
                        <div>No account: <a href="#" on-tap='registerDialog'> register</a></div>
                        <!--<div>Forgot your password? Click<a href="#" on-tap='resetPasswordDialog'> here</a></div>-->
                    </div>
                </paper-material>
            </div>


            <paper-dialog id="registerDialog">
                <paper-button class="close" dialog-dismiss>close</paper-button>

                <paper-input label="email" value="{{newEmail}}"></paper-input>
                <paper-input label="password" value="{{newPassword}}" type="password"></paper-input>
                <paper-input label="repeat password" value="{{repeatPassword}}" type="password"></paper-input>

                <div class="buttons">
                    <paper-button raised on-tap="register" disabled="[[disabled]]">
                        Register
                    </paper-button>
                </div>

            </paper-dialog>



            <paper-dialog id="resetPassword">
                <paper-button class="close" dialog-dismiss>close</paper-button>

                <paper-input label="email" value="{{resetEmail}}"></paper-input>

                <div class="buttons">
                    <paper-button raised on-tap="resetPassword" disabled="[[disabled]]">
                        Send new password
                    </paper-button>
                </div>

            </paper-dialog>

            <paper-toast id="toast"></paper-toast>

        </div>

    </template>

    <script>

        Polymer({

            is: 'view-login',

            properties:{
                disabled: {
                    type: Boolean,
                    reflectToAttribute: true,
                    value: false
                },
                signedIn: {
                    type: Boolean,
                    reflectToAttribute: true,
                    value: false,
                    notify: true,
                },
                user: {
                    type: Boolean,
                    notify: true,
                }
            },

            signIn: function(e){
                var that = this;
                this.$.auth.signInWithEmailAndPassword(this.email,this.password).catch(function(error) {
                    that.$.toast.show({text: error, duration: 3000});
                });
            },

            registerDialog: function(){
                this.$.registerDialog.open();
            },

            register: function(e){
                var that = this;
                if(this.newPassword==this.repeatPassword){
                    this.$.auth.createUserWithEmailAndPassword(this.newEmail,this.newPassword).catch(function(error) {
                        that.$.toast.show({text: error, duration: 3000});
                    });
                }
            },

            resetPasswordDialog: function(){
                this.$.resetPassword.open();
            },

            resetPassword: function(e){
                var that = this;
                this.$.auth.sendPasswordResetEmail(this.resetEmail).then(
                    function(){
                        that.$.toast.show({text: 'A recovery email was sent', duration: 3000});
                    },
                    function(error) {
                        that.$.toast.show({text: error, duration: 3000});
                });
            },

            signOut: function(){
                this.$.auth.signOut();
            },
            
            _hideLogin: function(signedIn){
                if(signedIn){
                    return 'hidden';
                }
                else{
                    return '';
                }
    
            },

        });

    </script>

</dom-module>
