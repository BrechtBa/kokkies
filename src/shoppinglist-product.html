
<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<link rel="import" href="../bower_components/paper-material/paper-material.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">

<link rel="import" href="shared-styles.html">
<link rel="import" href="object-list-behavior.html">


<dom-module id="shoppinglist-product">

    <template>

        <style include="iron-flex iron-flex-alignment"></style>
        <style include="shared-styles"></style>
        <style>
            :host {
                display: block;
            }
            paper-input{
                margin-top: -8px;
                margin-bottom: -8px;
            }
            .name{
                max-width: 200px;
            }
            .quantity{
                width: 60px;
                text-align: right;
            }
            .unit{
                width: 30px;
                margin-left: 3px;
            }
            .ordered{
                width: 80px;
            }
            .secondquantity{
                width: 40px;
                text-align: right;
            }
        </style>

        <firebase-document app-name="kokkies" path="/[[user.uid]]/shoppinglistproducts/[[period]]/[[shoppinglist]]/[[key]]" data="{{product}}"></firebase-document>

        <paper-material class="horizontal layout center wrap">
            <div class="name flex">{{_getObjectProperty(products,key,'name')}}</div>
            <div class="flex horizontal layout center">
                <div class="quantity">{{_round(quantity)}}</div>
                <div class="unit">{{_getObjectProperty(products,key,'unit')}}</div>
                <template is="dom-if" if="{{_hasSecondunit(products,key)}}">
                    <div class="quantity">~ [[_getSecondQuantity(products,key,quantity)]]</div>
                    <div class="unit">{{_getObjectProperty(products,key,'secondunit')}}</div>
                </template>
            </div>
            <div class="horizontal layout center">
                <div class="ordered"><paper-input label="besteld" value="{{product.ordered}}"></paper-input></div>
                <div class="unit">{{_getObjectProperty(products,key,'unit')}}</div>
            </div>
            <div class="checked"><paper-checkbox checked="{{_isChecked(product.ordered,quantity)}}" disabled></paper-checkbox></div>
        </paper-material>

    </template>

    <script>

        Polymer({
            is: 'shoppinglist-product',

            behaviors: [
                objectListBehavior,
            ],

            properties:{
                user: {
                    type: Object,
                },
                period: {
                    type: String,
                },
                shoppinglist: {
                    type: String,
                },
                key: {
                    type: String,
                },
                products: {
                    type: Object,
                },
                quantity: {
                    type: Number,
                },
            },

            _hasSecondunit: function(products,key){
                return this._getObjectProperty(products,key,'secondunit') != '';
            },

            _getSecondQuantity: function(products,key,quantity){
                return this._round( quantity*this._getObjectProperty(products,key,'unitconversion') );
            },

            _isChecked: function(ordered,quantity){
                return ordered >= 0.9*quantity;
            },

            _round: function(val){
                if(typeof val != 'undefined'){

                    var decimals = 0;

                    if(val < 1){
                        decimals = 2;
                    }
                    else if(val < 20){
                        decimals = 1;
                    }
   
                    return val.toFixed(decimals);
                }
            },

            shoppinglistHtml: function(){
                var html = '';

                html+= '                        <span class="name">'+this._getObjectProperty(this.products,this.key,'name')+'</span>';

                var quantity = this.quantity
                html+= '                        <span class="quantity">';
                if(typeof quantity != 'undefined'){
                    html+= this._round(quantity);
                }
                html+= '</span>\n';

                var unit = this._getObjectProperty(this.products,this.key,'unit')
                html+= '                        <span class="unit">';
                if(typeof unit != 'undefined'){
                    html+= unit;
                }
                html+= '</span>\n';


                var secondquantity = this._getSecondQuantity(this.products,this.key,quantity)
                var secondunit = this._getObjectProperty(this.products,this.key,'secondunit')
                html+= '                        <span class="quantity">';
                if(typeof secondquantity != 'undefined' && typeof secondunit != 'undefined' && secondunit != ''){
                    html+= '~ '+secondquantity;
                }
                html+= '</span>\n';

                html+= '                        <span class="unit">';
                if(typeof secondquantity != 'undefined' && typeof secondunit != 'undefined' && secondunit != ''){
                    html+= secondunit;
                }
                html+= '</span>\n';


                var ordered = this.product.ordered
                html+= '                        <span class="quantity ordered">';
                if(typeof ordered != 'undefined'){
                    html+= ordered;
                }
                html+= '</span>\n';

                html+= '                        <span class="unit ordered">';
                if(typeof unit != 'undefined' && typeof ordered != 'undefined'){
                    html+= unit;
                }
                html+= '</span>\n';

                return html;
            },

        });

    </script>

</dom-module>



