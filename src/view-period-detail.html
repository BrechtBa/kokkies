
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-localstorage/iron-localstorage.html">

<link rel="import" href="../bower_components/app-route/app-route.html">

<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-collapse/iron-collapse.html">

<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-material/paper-material.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">

<link rel="import" href="../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="../bower_components/polymerfire/firebase-query.html">

<link rel="import" href="shared-styles.html">

<link rel="import" href="view-period-detail-planning.html">
<link rel="import" href="view-period-detail-productgroups.html">
<link rel="import" href="view-period-detail-shoppinglists.html">


<dom-module id="view-period-detail">

    <template>

        <style include="iron-flex iron-flex-alignment"></style>
        <style include="shared-styles"></style>
        <style>
            :host {
                display: block;
                padding: 10px;
            }
            .period{
                margin-left: 10px;
                margin-right: 10px;
                margin-top: 20px;
                margin-bottom: 10px;
            }

            .detail{
                background-color: #ffffff;
                margin: 10px;
                min-width: 200px;
            }
            .detail a{
                text-decoration: none;
                color: #222222;
            }
            .icon{
                height: 200px;
            }
            .title{
                font-size: 20px;
            }
            iron-icon{
                color: #555555;
            }
            paper-icon-button{
                color: #555555;
            }
        </style>

        <firebase-document app-name="kokkies" path="/[[user.uid]]/periods/[[periodKey]]" data="{{period}}"></firebase-document>
        <firebase-document app-name="kokkies" path="/[[user.uid]]/productgroups/[[periodKey]]" data="{{productgroups}}"></firebase-document>
        <firebase-document app-name="kokkies" path="/[[user.uid]]/shoppinglists/[[periodKey]]" data="{{shoppinglists}}"></firebase-document>


        <app-route route="{{route}}" pattern="/:key" data="{{routeData}}" tail="{{subroute}}"></app-route>
        

        <div class="period horizontal layout wrap">
            <paper-input label="Periode" value="{{period.name}}"></paper-input>
            <div class="flex">&nbsp;</div>
            <paper-input label="Start Datum" value="{{period.startdate}}" pattern="[0-9][0-9]-[0-9][0-9]-[0-9][0-9][0-9][0-9]" auto-validate error-message="dd-mm-yyyy"></paper-input>
        </div>


        <iron-pages role="sub" selected="[[page]]" attr-for-selected="name">

            <div name="base">
                <div class="horizontal layout wrap">

                    <paper-material class="detail flex vertical layout center">
                        <a href="/periods/[[periodKey]]/planning">
                            <div class="icon"></div>
                            <div class="title">Planning</div>
                        </a>
                    </paper-material>

                    <paper-material class="detail flex vertical layout center">
                        <a href="/periods/[[periodKey]]/productgroups">
                            <div class="icon"></div>
                            <div class="title">Gerechten</div>
                        </a>
                    </paper-material>

                    <paper-material class="detail flex vertical layout center">
                        <a href="/periods/[[periodKey]]/shoppinglists">
                            <div class="icon"></div>
                            <div class="title">Winkellijstjes</div>
                        </a>
                    </paper-material>
                </div>
            </div>

            <div name="planning">
                <h1>Planning</h1>
                <view-period-detail-planning user="[[user]]" period="[[periodKey]]" days="{{period.days}}" period-startdate="{{period.startdate}}" productgroups="{{productgroups}}" products="{{products}}" shoppinglists="{{shoppinglists}}"></view-period-detail-menu>
            </div>
            
            <div name="productgroups">
                <h1>Gerechten</h1>
                <view-period-detail-productgroups user="[[user]]" period="[[periodKey]]" productgroups="{{period.productgroups}}" products="{{products}}"></view-period-detail-productgroups>
            </div>

            <div name="shoppinglists">
                <h1>Winkellijstjes</h1>
                <view-period-detail-shoppinglists user="[[user]]" period="[[periodKey]]" productgroups="{{productgroups}}" products="{{products}}" shoppinglists="{{period.shoppinglists}}"></view-period-detail-shoppinglists>
            </div>

        </iron-pages>





<!--
        <div class="horizontal layout">
            <paper-input label="Periode" value="{{period.name}}"></paper-input>
            <div class="flex">&nbsp;</div>
            <paper-input label="Start Datum" value="{{period.startdate}}" pattern="[0-9][0-9]-[0-9][0-9]-[0-9][0-9][0-9][0-9]" auto-validate error-message="dd-mm-yyyy"></paper-input>
        </div>

        <template is="dom-repeat" items="{{_toArray(period.days)}}" as="day" sort=_sortByVal>

            <period-day user="[[user]]" period="[[periodKey]]" key="[[day.key]]" number="[[day.val]]" date="[[_computeDayDate(period.startdate,day.val)]]" products="{{products}}" productgroups="{{productgroups}}" shoppinglists="{{shoppinglists}}" on-delete="deleteDay" on-move-up="moveUpDay" on-move-down="moveDownDay"></period-day>

        </template>
        
        <paper-button raised on-tap="newDay">Dag toevoegen</paper-button>
        
        
        
        
        <h2>Winkellijstjes</h2>
        
        <template is="dom-repeat" items="{{_toArray(period.shoppinglists)}}" as="shoppinglist">

            <period-shoppinglist user="[[user]]" period="[[periodKey]]" key="{{shoppinglist.key}}" dayproductgroups="{{dayproductgroups}}" dayproductgroupproducts="{{dayproductgroupproducts}}" products="{{products}}" productgroups="{{productgroups}}" ></period-shoppinglist>

        </template>
        
        <paper-button raised on-tap="newShoppinglist">Winkellijst toevoegen</paper-button>
-->
        
        
        
        
        
    </template>

    <script>

        Polymer({
            is: 'view-period-detail',

            behaviors: [
                objectListBehavior,
                searchFilterBehavior,
                collapsibleBehavior,
            ],

            properties:{
                user: {
                    type: 'Object'
                },
                products: {
                    type: 'Object',
                    notify: true
                },
                route: {
                    type: 'string'
                }
            },

            observers: [
                '_routeKeyChanged(routeData.key)',
                '_subroutePathChanged(subroute.path)'
            ],

            back: function(e){
                if(typeof this.page == 'undefined' || this.page == '' || this.page == 'base'){
                    this.set('route.path','');
                }
                else{
                    this.set('route.path','/'+this.periodKey);
                }
            },

            _routeKeyChanged: function(key){
                if(typeof key!='undefined' && key!=''){ 
                    if(key=='new'){
                        var key = btoa(this.user.uid + Date.now());
                        this.set('periods.'+key,{'name':'newperiod','startdate': 0});
                        this.periodKey = key;
                                                
                        this.set('days',{});
                        this.set('shoppinglists',{});
                        
                        this.set('route.path','/'+key);
                    }
                    else{
                        this.set('periodKey',key);
                    }
                }
            },

            _subroutePathChanged: function(path){
                if(typeof path!='undefined' && path!=''){ 
                    if(path=='/planning'){
                        this.set('page', 'planning');
                    }
                    else if(path=='/productgroups'){
                        this.set('page', 'productgroups');
                    }
                    else if(path=='/shoppinglists'){
                        this.set('page', 'shoppinglists');
                    }
                    else{
                        this.set('page', 'base');
                    }
                }
                else{
                    this.set('page', 'base');
                }
            },

        });

    </script>

</dom-module>
